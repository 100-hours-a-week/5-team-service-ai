# ai-pr-alert.yml
name: PR Review Request Notification
on:
  pull_request:
    types: [review_requested]

jobs:
  notify-pr:
    runs-on: ubuntu-latest
    steps:
      - name: Send Notification to Reviewer
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK_URL }}
          # AI íŒ€ ë©¤ë²„ Discord ID ë§¤í•‘ (í•„ìš”ì‹œ secretsì— ì¶”ê°€)
          DISCORD_ID_AI_MASON: ${{ secrets.DISCORD_ID_AI_MASON }}
        run: |
          # 1. ë¦¬ë·°ì–´ë¡œ ì§€ì •ëœ ì‚¬ëŒì˜ GitHub ì•„ì´ë”” ê°€ì ¸ì˜¤ê¸°
          REQUESTED_GITHUB_USER="${{ github.event.requested_team.name || github.event.requested_reviewer.login }}"

          # 2. GitHub ì•„ì´ë””ë¥¼ Discord ë©˜ì…˜ìœ¼ë¡œ ë³€í™˜ (ë§¤í•‘ ë¡œì§)
          # TODO: AI íŒ€ ë©¤ë²„ GitHub IDì™€ Discord ID ë§¤í•‘ ì¶”ê°€
          case "$REQUESTED_GITHUB_USER" in
            "Jiwoo-Leee")
              MENTION="<@DISCORD_ID_AI_MASON>"
              ;;
            *)
              # ë§¤í•‘ ì•ˆ ëœ ì‚¬ëŒì´ë©´ AI íŒ€ ì „ì²´ í˜¸ì¶œ
              MENTION="@AITeam (ë¦¬ë·°ì–´ ë§¤í•‘ í•„ìš”)"
              ;;
          esac

          # 3. ë©”ì‹œì§€ ì „ì†¡
          PR_TITLE="${{ github.event.pull_request.title }}"
          PR_URL="${{ github.event.pull_request.html_url }}"
          AUTHOR="${{ github.actor }}"

          MESSAGE="ğŸ‘€ **[AI ì½”ë“œ ë¦¬ë·° ìš”ì²­]**\n\n$MENTION ë‹˜! **$AUTHOR** ë‹˜ì´ ë¦¬ë·°ë¥¼ ìš”ì²­í–ˆìŠµë‹ˆë‹¤.\n\nì œëª©: **$PR_TITLE**\në§í¬: $PR_URL"

          curl -H "Content-Type: application/json" \
               -X POST \
               -d "{ \"content\": \"$MESSAGE\" }" \
               $DISCORD_WEBHOOK
